{% extends "base.html" %}

{% block title %}Personenverwaltung{% endblock %}

{% block content %}
<h1>ğŸ‘¥ Personenverwaltung</h1>

<p>Insgesamt {{ persons|length }} Personen registriert.</p>

<table class="person-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Samples</th>
            <th>Erstellt</th>
            <th>Aktionen</th>
        </tr>
    </thead>
    <tbody>
        {% for person in persons %}
        <tr>
            <td>{{ person.id }}</td>
            <td>
                <strong>{{ person.name }}</strong>
                {% if person.name.startswith('Unbekannt') %}
                <span class="badge badge-unknown">Unbenannt</span>
                {% endif %}
            </td>
            <td>{{ person.sample_count }} Samples</td>
            <td>{{ person.created_at }}</td>
            <td>
                <a href="/persons/{{ person.id }}" class="button-small">Details</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>ğŸ”€ Personen zusammenfÃ¼hren (Merge)</h2>
<form method="POST" action="/persons/merge" class="merge-form">
    <div class="form-row">
        <div class="form-group">
            <label for="from_id">Von Person (wird gelÃ¶scht):</label>
            <select name="from_id" id="from_id" required>
                <option value="">-- Person wÃ¤hlen --</option>
                {% for person in persons %}
                <option value="{{ person.id }}">{{ person.id }}: {{ person.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="into_id">In Person (bleibt erhalten):</label>
            <select name="into_id" id="into_id" required>
                <option value="">-- Person wÃ¤hlen --</option>
                {% for person in persons %}
                <option value="{{ person.id }}">{{ person.id }}: {{ person.name }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <button type="submit" class="button button-warning"
            onclick="return confirm('Wirklich zusammenfÃ¼hren? Dies kann nicht rÃ¼ckgÃ¤ngig gemacht werden!')">
        ğŸ”€ Merge durchfÃ¼hren
    </button>
</form>

<p class="help-text">
    âš ï¸ <strong>Hinweis:</strong> Beim Merge werden alle Samples von Person A zu Person B verschoben.
    Person A wird als "merged" markiert und ist danach nicht mehr sichtbar.
</p>
{% endblock %}
