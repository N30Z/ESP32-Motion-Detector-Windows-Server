# ESP32 Motion Detector - Server Configuration
# ==============================================

server:
  host: '0.0.0.0'  # Listen on all interfaces
  port: 5000
  debug: false  # Set to true for development only
  log_level: 'DEBUG'  # DEBUG, INFO, WARNING, ERROR - Set to DEBUG for troubleshooting
  log_file: 'server.log'

security:
  # IMPORTANT: Change this token before deployment!
  # Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
  auth_token: 'YOUR_SECRET_TOKEN_CHANGE_ME_12345'

  # Require authentication for stream endpoint
  require_auth_for_stream: true

storage:
  # Directory for storing captured images
  image_dir: './captured_images'

  # Auto-cleanup old images (future feature)
  max_images: 1000
  max_age_days: 30

notifications:
  # Enable notifications
  enabled: true

  # Notification backend: 'windows_toast', 'linux_notify', 'disabled'
  # - windows_toast: Windows 10/11 Toast notifications (requires winotify)
  # - linux_notify: Linux Desktop notifications via notify-send (requires libnotify)
  # - disabled: No OS notifications (headless servers, events visible in Web UI)
  backend: 'windows_toast'  # Change to 'linux_notify' on Linux or 'disabled' for headless

  # Play sound with notification (if supported by backend)
  sound: true

face_recognition:
  # Enable face recognition pipeline
  enabled: true  # Face recognition enabled

  # Database
  db_path: './faces.db'
  faces_dir: './faces_db'  # Directory for face crops

  # Matching thresholds (cosine distance)
  # GREEN: d1 < threshold_strict AND margin > margin_strict
  # YELLOW: d1 < threshold_loose AND margin > margin_loose
  # UNKNOWN: otherwise

  threshold_strict: 0.35   # Distance for reliable match (lower = stricter)
  threshold_loose: 0.50    # Distance for uncertain match
  margin_strict: 0.15      # Margin (d2-d1) for reliable match (higher = more distinct)
  margin_loose: 0.08       # Margin for uncertain match

  # Quality thresholds for auto-learning
  min_face_size: 10000     # Minimum face area in pixels (100x100)
  min_quality_score: 0.6   # Minimum quality score (0-1)

  # Auto-learning settings
  auto_learning:
    enabled: true
    max_samples_per_person: 15      # Maximum samples per person
    cooldown_seconds: 60            # Cooldown between auto-learning
    only_green_matches: true        # Only learn from GREEN matches
    replace_strategy: 'oldest'      # oldest | lowest_quality

  # New person creation
  auto_create_person: true          # Auto-create person on UNKNOWN
  new_person_name_template: 'Unbekannt #{count}'

stream:
  # Target framerate for live stream (ESP32 limited to ~10-15 fps realistic)
  target_fps: 10

  # JPEG quality for stream frames (0-100, lower = smaller size)
  jpeg_quality: 80
